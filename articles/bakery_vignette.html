<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GEEutils: a bakery for extra sandwiches • GEEutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GEEutils: a bakery for extra sandwiches">
<meta property="og:description" content="GEEutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GEEutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Zimmerman_vignette.html">GEEutils: reproducing the pseudoreplication paper by Zimmerman et al.</a>
    </li>
    <li>
      <a href="../articles/bakery_vignette.html">GEEutils: a bakery for extra sandwiches</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jgilis/GEEutils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bakery_vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GEEutils: a bakery for extra sandwiches</h1>
                        <h4 class="author">Jeroen Gilis</h4>
            
            <h4 class="date">09/01/2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jgilis/GEEutils/blob/master/vignettes/bakery_vignette.Rmd"><code>vignettes/bakery_vignette.Rmd</code></a></small>
      <div class="hidden name"><code>bakery_vignette.Rmd</code></div>

    </div>

    
    
<p>Here I demonstrate the <code>bakery</code> function of GEEutils. The goal of <code>bakery</code> is to allow for specifying multiple methods for computing robust standard errors. By default, <code>bakery</code> adopts the robust standard error (sandwich) method introduce by <a href="https://doi.org/10.1093/biomet/73.1.13">Liang and Zeger</a> in 1986. In addition, bakery currently allows for specifying two additional sandwich estimation procedures:</p>
<ul>
<li><p>The sandwich estimator of <a href="https://doi.org/10.1198/016214501753382309">Kauermann and Carroll</a> (KC).</p></li>
<li><p>The sandwich estimator of <a href="https://doi.org/10.1093/biomet/88.3.901">Pan</a> (Pan).</p></li>
</ul>
<p>These estimators, along with several others, have already been implemented in R in the package <a href="https://cran.r-project.org/web/packages/geesmv/index.html">geesmv</a>. However, the different sandwich estimation procedures from <code>geesmv</code> requires refitting the GEE model, which, at least for the <code>KC</code> and <code>Pan</code> estimators, is unnecessary. As refitting the GEE models can be slow in the contexxt of scRNA-Seq data, I have written <code>bakery</code> to avoid spurious computations.</p>
<div id="install-geeutils" class="section level1">
<h1 class="hasAnchor">
<a href="#install-geeutils" class="anchor"></a>Install GEEutils</h1>
<pre><code>devtools::install_local("/Users/jg/Desktop/PhD/GEE/GEEutils", force = T, quiet = F)</code></pre>
</div>
<div id="load-libraries" class="section level1">
<h1 class="hasAnchor">
<a href="#load-libraries" class="anchor"></a>Load libraries</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jgilis/GEEutils">GEEutils</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geepack</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geeM</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geesmv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gee</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="create-data" class="section level1">
<h1 class="hasAnchor">
<a href="#create-data" class="anchor"></a>Create data</h1>
<p>I simply create a single Poisson distributed random variable for demonstration purposes.</p>
<p>Note: 10 clusters of size 50 is the minimal #number of clusters and cluster size in <a href="https://doi.org/10.1002/sim.6344">Li and Redden</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">77</span><span class="op">)</span>
<span class="va">gene1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3</span><span class="op">)</span>
<span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"treat"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">250</span><span class="op">)</span>
<span class="va">patient_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">50</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">gene1</span>,<span class="va">group_id</span>,<span class="va">patient_id</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">gene1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">gene1</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">patient_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">patient_id</span><span class="op">)</span></code></pre></div>
</div>
<div id="fit-gee" class="section level1">
<h1 class="hasAnchor">
<a href="#fit-gee" class="anchor"></a>Fit GEE</h1>
<div id="gee-with-geepack" class="section level2">
<h2 class="hasAnchor">
<a href="#gee-with-geepack" class="anchor"></a>GEE with GEEpack</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geepack/man/geese.html">geese</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
  id <span class="op">=</span> <span class="va">patient_id</span>,
  family <span class="op">=</span> <span class="va">poisson</span>,
  data <span class="op">=</span> <span class="va">data</span>,
  corstr <span class="op">=</span> <span class="st">"exch"</span><span class="op">)</span>

<span class="va">m1</span><span class="op">$</span><span class="va">beta</span> <span class="co"># estimates</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m1</span><span class="op">$</span><span class="va">vbeta.naiv</span><span class="op">)</span><span class="op">)</span> <span class="co"># SE</span>
<span class="co">#&gt; [1] 0.02206424 0.03181203</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m1</span><span class="op">$</span><span class="va">vbeta</span><span class="op">)</span><span class="op">)</span> <span class="co"># sandwich SE</span>
<span class="co">#&gt; [1] 0.01990989 0.03192378</span></code></pre></div>
</div>
<div id="gee-with-gee" class="section level2">
<h2 class="hasAnchor">
<a href="#gee-with-gee" class="anchor"></a>GEE with gee</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gee/man/gee.html">gee</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
  id <span class="op">=</span> <span class="va">patient_id</span>,
  data <span class="op">=</span> <span class="va">data</span>,
  family <span class="op">=</span> <span class="va">poisson</span>,
  corstr <span class="op">=</span> <span class="st">"exchangeable"</span><span class="op">)</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>

<span class="va">m2</span><span class="op">$</span><span class="va">coefficients</span> <span class="co"># estimates</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m2</span><span class="op">$</span><span class="va">naive.variance</span><span class="op">)</span><span class="op">)</span> <span class="co"># SE --&gt; different from geese, but same as geeM with default useP</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    0.02218202    0.03198184</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m2</span><span class="op">$</span><span class="va">robust.variance</span><span class="op">)</span><span class="op">)</span> <span class="co"># sandwich SE --&gt; same</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    0.01990989    0.03192378</span></code></pre></div>
</div>
<div id="gee-with-geem" class="section level2">
<h2 class="hasAnchor">
<a href="#gee-with-geem" class="anchor"></a>GEE with geeM</h2>
<p>Last but not least, we fit the GEE with the R package <a href="https://cran.r-project.org/web/packages/geeM/index.html">geeM</a>. geeM is unique in that it implements the GEE procedure fully in R. According to their publication, this did not have a severe impact on scalability <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4289620/">geeM paper</a>.</p>
<p>The abstract summarizes how this was achieved: […] geeM, which is implemented entirely in R and allows for user specified link and variance functions. The sparse matrix representations provided in the Matrix package enable a fast implementation. To gain speed, we make use of analytic inverses of the working correlation when possible and a trick to find quick numeric inverses when an analytic inverse is not available. Through three examples, we demonstrate the speed of geeM, which is not much worse than C implementations like geepack and gee on small data sets and <strong>faster on large data sets</strong>.</p>
<p>Note: I do have two concers with this method;</p>
<ul>
<li><p>Stability towards sparse data</p></li>
<li><p>Scalability in terms of memory usage (stacking matrices in stead of summing)</p></li>
</ul>
<p>These were assessed in the paper but in another context.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geeM/man/geem.html">geem</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
  id <span class="op">=</span> <span class="va">patient_id</span>,
  family <span class="op">=</span> <span class="va">poisson</span>,
  corstr <span class="op">=</span> <span class="st">"exch"</span>,
  useP <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="va">m3</span><span class="op">$</span><span class="va">beta</span> <span class="co"># estimates</span>
<span class="co">#&gt; [1]  1.12102588 -0.07581437</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m3</span><span class="op">$</span><span class="va">naiv.var</span><span class="op">)</span><span class="op">)</span> <span class="co"># SE --&gt; different from geese, but same if useP = FALSE (TRUE is default though)</span>
<span class="co">#&gt; [1] 0.02218202 0.03198184</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">m3</span><span class="op">$</span><span class="va">var</span><span class="op">)</span><span class="op">)</span> <span class="co"># sandwich SE --&gt; same</span>
<span class="co">#&gt; [1] 0.01990989 0.03192378</span></code></pre></div>
</div>
</div>
<div id="compute-sandwich-using-geesmv" class="section level1">
<h1 class="hasAnchor">
<a href="#compute-sandwich-using-geesmv" class="anchor"></a>Compute sandwich using geesmv</h1>
<p>Note; geesmv uses the gee package for fitting the GEE model with the sandwich estimator of Liang and Zeger as a default.</p>
<div id="liang-and-zeger-lz" class="section level2">
<h2 class="hasAnchor">
<a href="#liang-and-zeger-lz" class="anchor"></a>Liang and Zeger (LZ)</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lz.exch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geesmv/man/GEE.var.lz.html">GEE.var.lz</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
                        id<span class="op">=</span><span class="st">"patient_id"</span>,
                        family<span class="op">=</span><span class="st">"poisson"</span>,
                        data<span class="op">=</span><span class="va">data</span>,
                        corstr<span class="op">=</span><span class="st">"exchangeable"</span><span class="op">)</span> <span class="co">##Exchangeable correlation structure;</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>

<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">lz.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span> <span class="co"># same sandwich SE (Liang and zeger)</span>
<span class="co">#&gt; [1] 0.01990989 0.03192378</span></code></pre></div>
</div>
<div id="pan-pan" class="section level2">
<h2 class="hasAnchor">
<a href="#pan-pan" class="anchor"></a>Pan (Pan)</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pan.exch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geesmv/man/GEE.var.pan.html">GEE.var.pan</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
                        id<span class="op">=</span><span class="st">"patient_id"</span>,
                        family<span class="op">=</span><span class="st">"poisson"</span>,
                        data<span class="op">=</span><span class="va">data</span>,
                        corstr<span class="op">=</span><span class="st">"exchangeable"</span><span class="op">)</span> <span class="co">##Exchangeable correlation structure;</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>

<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pan.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span> <span class="co"># different SE --&gt; same as model SE?? --&gt; probably because Exch + all clusters same size</span>
<span class="co">#&gt; [1] 0.02206424 0.03181203</span></code></pre></div>
</div>
<div id="kauermann-and-carroll-kc" class="section level2">
<h2 class="hasAnchor">
<a href="#kauermann-and-carroll-kc" class="anchor"></a>Kauermann and Carroll (KC)</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kc.exch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geesmv/man/GEE.var.kc.html">GEE.var.kc</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
                      id<span class="op">=</span><span class="st">"patient_id"</span>,
                      family<span class="op">=</span><span class="st">"poisson"</span>,
                      data<span class="op">=</span><span class="va">data</span>,
                      corstr<span class="op">=</span><span class="st">"exchangeable"</span><span class="op">)</span> <span class="co">##Exchangeable correlation structure;</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span>

<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">kc.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span> <span class="co"># different SE</span>
<span class="co">#&gt; [1] 0.02225994 0.03569187</span></code></pre></div>
</div>
</div>
<div id="bakery" class="section level1">
<h1 class="hasAnchor">
<a href="#bakery" class="anchor"></a>bakery</h1>
<p>Since I would be very much interested in porting the work from <a href="https://doi.org/10.1002/sim.6344">Li and Redden</a> and <a href="https://pubmed.ncbi.nlm.nih.gov/26998504/">Rogers and Stoner</a>, who assessed the suitability of different sandwich estimators on (rare-event) binomial data.</p>
<p>In this context, it would be nice to have a wrapper / convenience function for GEEs. Note that with geesmv, we always need to refit the entire GEE, which is inefficient. Luckily, as both geeM as the sandwich part of geesmv are written entirily in R, we can easily write a convenience function that e.g. fits a gee with LZ, and can than compute alternative standard errors without refitting the GEE.</p>
<p>For our application, it would suffice to do this for a poisson link GEE only.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/bakery.html">bakery</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>,
         id<span class="op">=</span><span class="st">"patient_id"</span>,
         data<span class="op">=</span><span class="va">data</span>,
         family<span class="op">=</span><span class="st">"poisson"</span>,
         corstr<span class="op">=</span><span class="st">"exchangeable"</span>,
         silent <span class="op">=</span> <span class="cn">TRUE</span>,
         extraSandwich <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"KC"</span>,<span class="st">"Pan"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    1.12102588   -0.07581437</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">robust.variance</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># LZ</span>
<span class="co">#&gt; [1] 0.01990989 0.03192378</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">KC.variance</span><span class="op">)</span><span class="op">)</span> <span class="co"># KC</span>
<span class="co">#&gt; [1] 0.02225994 0.03569187</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Pan.variance</span><span class="op">)</span><span class="op">)</span> <span class="co"># Pan</span>
<span class="co">#&gt; [1] 0.02206424 0.03181203</span></code></pre></div>
<p>Check if correct</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">lz.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.01990989 0.03192378</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">kc.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.02225994 0.03569187</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">pan.exch</span><span class="op">$</span><span class="va">cov.beta</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.02206424 0.03181203</span></code></pre></div>
</div>
<div id="a-wald-sandwich-please" class="section level1">
<h1 class="hasAnchor">
<a href="#a-wald-sandwich-please" class="anchor"></a>A Wald sandwich, please</h1>
<p>Adopting the sandwich package in a helper function that tests provided contrasts in <code>glm</code> (i.e., not <code>GEE</code>) models. In the example above, we only have 1 contrast to be tested, which translates into</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pois.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span>, family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>

<span class="co"># regular SEs</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    0.03610791    0.05206007</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># sandwich SEs with sandwich function</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="http://sandwich.R-Forge.R-project.org//reference/sandwich.html">sandwich</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   (Intercept) group_idtreat </span>
<span class="co">#&gt;    0.03800793    0.05253486</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># GEEutils</span>

<span class="co">## Requires a contrast matrix (could set a default coefficient if not provided)</span>
<span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group_id</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
<span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span>
<span class="va">L</span><span class="op">[</span><span class="st">"group_idtreat"</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="co"># no sandwich</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>
                models <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>, 
                contrast <span class="op">=</span> <span class="va">L</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, 
                sandwich <span class="op">=</span> <span class="cn">FALSE</span>, 
                adjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">pois.res</span><span class="op">$</span><span class="va">se</span>
<span class="co">#&gt; [1] 0.05206007</span>

<span class="co"># LZ sandwich</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>
                models <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>, 
                contrast <span class="op">=</span> <span class="va">L</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, 
                sandwich <span class="op">=</span> <span class="cn">TRUE</span>, 
                adjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">pois.res</span><span class="op">$</span><span class="va">se</span>
<span class="co">#&gt; [1] 0.05253486</span>

<span class="co"># LZ sandwich adjusted for small sample size</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>
                models <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>, 
                contrast <span class="op">=</span> <span class="va">L</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, 
                sandwich <span class="op">=</span> <span class="cn">TRUE</span>, 
                adjust <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">pois.res</span><span class="op">$</span><span class="va">se</span>
<span class="co">#&gt; [1] 0.05264024</span></code></pre></div>
<p>Note that the <code>glm.Waldtest</code> function is flexible towards “multi-contrast” settings. I demonstrate this using new simulated data, mimicking a multi-patient multi-celltype setting.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">77</span><span class="op">)</span>
<span class="va">gene1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span><span class="fl">500</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"treat"</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">750</span><span class="op">)</span>
<span class="va">patient_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"patient"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">150</span><span class="op">)</span>
<span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type1"</span>, <span class="st">"type2"</span>, <span class="st">"type3"</span><span class="op">)</span>,each<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,<span class="fl">10</span><span class="op">)</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">gene1</span>,<span class="va">group_id</span>,<span class="va">patient_id</span>,<span class="va">cell_type</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">gene1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">gene1</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">patient_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">patient_id</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">cell_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">cell_type</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pois.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">gene1</span> <span class="op">~</span> <span class="va">group_id</span><span class="op">*</span><span class="va">cell_type</span>, family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; glm(formula = gene1 ~ group_id * cell_type, family = poisson, </span>
<span class="co">#&gt;     data = data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span>
<span class="co">#&gt; -2.7466  -0.7949  -0.1438   0.6556   3.3644  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                              Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; (Intercept)                   1.03957    0.03761  27.642  &lt; 2e-16 ***</span>
<span class="co">#&gt; group_idtreat                 0.16760    0.05109   3.280  0.00104 ** </span>
<span class="co">#&gt; cell_typetype2               -0.07183    0.05417  -1.326  0.18485    </span>
<span class="co">#&gt; cell_typetype3               -0.07640    0.05423  -1.409  0.15893    </span>
<span class="co">#&gt; group_idtreat:cell_typetype2  0.04516    0.07320   0.617  0.53732    </span>
<span class="co">#&gt; group_idtreat:cell_typetype3  0.19683    0.07210   2.730  0.00633 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 1948.3  on 1499  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 1863.6  on 1494  degrees of freedom</span>
<span class="co">#&gt; AIC: 6009</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># contrast matrix</span>
<span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">group_id</span><span class="op">*</span><span class="va">cell_type</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span>
<span class="va">L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span>
<span class="va">L</span><span class="op">[</span><span class="st">"group_idtreat"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">L</span><span class="op">[</span><span class="st">"group_idtreat:cell_typetype2"</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> 
<span class="va">L</span><span class="op">[</span><span class="st">"group_idtreat:cell_typetype3"</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type1"</span>, <span class="st">"type2"</span>, <span class="st">"type3"</span><span class="op">)</span>
<span class="va">L</span>
<span class="co">#&gt;                              type1 type2 type3</span>
<span class="co">#&gt; (Intercept)                      0     0     0</span>
<span class="co">#&gt; group_idtreat                    1     1     1</span>
<span class="co">#&gt; cell_typetype2                   0     0     0</span>
<span class="co">#&gt; cell_typetype3                   0     0     0</span>
<span class="co">#&gt; group_idtreat:cell_typetype2     0     1     0</span>
<span class="co">#&gt; group_idtreat:cell_typetype3     0     0     1</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># no sandwich</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>models<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>,
                 contrast<span class="op">=</span><span class="va">L</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,
                 sandwich<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">pois.res</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">7</span>,<span class="fl">12</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;         se         se         se </span>
<span class="co">#&gt; 0.05109402 0.05242383 0.05086416</span>

<span class="co"># LZ sandwich</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>,
                 contrast <span class="op">=</span> <span class="va">L</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,
                 sandwich <span class="op">=</span> <span class="cn">TRUE</span>,
                 adjust <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">pois.res</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">7</span>,<span class="fl">12</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;         se         se         se </span>
<span class="co">#&gt; 0.05517595 0.05592539 0.05297223</span>

<span class="co"># LZ sandwich adjusted for small sample size</span>
<span class="va">pois.res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span>
    <span class="fu">GEEutils</span><span class="fu">::</span><span class="fu"><a href="../reference/glm.Waldtest.html">glm.Waldtest</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pois.model</span><span class="op">)</span>,
                 contrast <span class="op">=</span> <span class="va">L</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>,
                 sandwich <span class="op">=</span> <span class="cn">TRUE</span>,
                 adjust <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">pois.res</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">7</span>,<span class="fl">12</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;         se         se         se </span>
<span class="co">#&gt; 0.05528663 0.05603758 0.05307849</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeroen Gilis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
